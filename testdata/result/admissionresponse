[{"op":"remove","path":"/spec/containers/0"},{"op":"add","path":"/spec/containers/-","value":{"name":"keymaker-original","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:latest","command":["sleep"],"args":["infinity"],"ports":[{"name":"http","containerPort":7020,"protocol":"TCP"}],"resources":{},"volumeMounts":[{"name":"kaas-keymaker-orlgsgcsl34imsg6-token-kn2t8","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"},{"name":"keytabs","mountPath":"/etc/keytabs"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}},{"op":"remove","path":"/spec/initContainers/1"},{"op":"remove","path":"/spec/initContainers/0"},{"op":"add","path":"/spec/initContainers/-","value":{"name":"ca-populator-original","image":"791719295754.dkr.ecr.us-east-2.amazonaws.com/dva/pki_aws_bootstrap:6","args":["/bin/cp","/etc/ssl/certs/cacerts.pem","/etc/pki_service/ca/cacerts.pem"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"madkub-init-original","image":"791719295754.dkr.ecr.us-east-2.amazonaws.com/dva/pki_aws_bootstrap:6","args":["/bin/cp","/etc/ssl/certs/cacerts.pem","/etc/pki_service/ca/cacerts.pem"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"init-fqdn","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:38","command":["sh","-c","mkdir -p /etc/keytabs/config; cp /etc/fqdn/fqdn /etc/keytabs/config/"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"fqdn","mountPath":"/etc/fqdn"}],"imagePullPolicy":"Always"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"krb5-populator","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:38","args":["/opt/keymaker-client/set_krb5.sh","DEVMVP.SFDC.NET"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"}],"imagePullPolicy":"Always"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"keymaker-client","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:38","args":["/opt/keymaker-client/keymaker-client","--service-name=keymaker","--client-cert=/etc/identity/client/certificates/client.pem","--client-key=/etc/identity/client/keys/client-key.pem","--keytab-owner=sfdc"],"resources":{},"volumeMounts":[{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"keytabs","mountPath":"/etc/keytabs"}],"imagePullPolicy":"Always"}},{"op":"add","path":"/spec/volumes/-","value":{"name":"keytabs","emptyDir":{"medium":"Memory"}}},{"op":"add","path":"/metadata/annotations/keymaker.k8s-integration.sfdc.com~1status","value":"injected"},{"op":"remove","path":"/spec/containers/0"},{"op":"add","path":"/spec/containers/-","value":{"name":"keymaker-original","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:latest","command":["sleep"],"args":["infinity"],"ports":[{"name":"http","containerPort":7020,"protocol":"TCP"}],"resources":{},"volumeMounts":[{"name":"kaas-keymaker-orlgsgcsl34imsg6-token-kn2t8","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"},{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}},{"op":"remove","path":"/spec/initContainers/4"},{"op":"remove","path":"/spec/initContainers/3"},{"op":"remove","path":"/spec/initContainers/2"},{"op":"remove","path":"/spec/initContainers/1"},{"op":"remove","path":"/spec/initContainers/0"},{"op":"add","path":"/spec/initContainers/-","value":{"name":"ca-populator-original","image":"791719295754.dkr.ecr.us-east-2.amazonaws.com/dva/pki_aws_bootstrap:6","args":["/bin/cp","/etc/ssl/certs/cacerts.pem","/etc/pki_service/ca/cacerts.pem"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"madkub-init-original","image":"791719295754.dkr.ecr.us-east-2.amazonaws.com/dva/pki_aws_bootstrap:6","args":["/bin/cp","/etc/ssl/certs/cacerts.pem","/etc/pki_service/ca/cacerts.pem"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"init-fqdn","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:38","command":["sh","-c","mkdir -p /etc/keytabs/config; cp /etc/fqdn/fqdn /etc/keytabs/config/"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"fqdn","mountPath":"/etc/fqdn"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"imagePullPolicy":"Always"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"krb5-populator","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:38","args":["/opt/keymaker-client/set_krb5.sh","DEVMVP.SFDC.NET"],"resources":{},"volumeMounts":[{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"imagePullPolicy":"Always"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"keymaker-client","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/keymaker-client:38","args":["/opt/keymaker-client/keymaker-client","--service-name=keymaker","--client-cert=/etc/identity/client/certificates/client.pem","--client-key=/etc/identity/client/keys/client-key.pem","--keytab-owner=sfdc"],"resources":{},"volumeMounts":[{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"keytabs","mountPath":"/etc/keytabs"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"imagePullPolicy":"Always"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"ca-populator","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/sam/madkub:122","args":["/bin/cp","/etc/ssl/certs/cacerts.pem","/etc/pki_service/ca/cacerts.pem"],"resources":{},"volumeMounts":[{"name":"ca","mountPath":"/etc/pki_service/ca"}],"imagePullPolicy":"IfNotPresent"}},{"op":"add","path":"/spec/initContainers/-","value":{"name":"madkub-init","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/sam/madkub:122","args":["/sam/madkub-client","--mode=gcpserviceaccount","--sa-secret=/secrets/serviceaccount/key.json","--maddog-endpoint=https://10.168.193.16:8443","--maddog-server-ca=/etc/pki_service/ca/cacerts.pem","--cert-folders=clientcert:/etc/identity","--cert-folders=servercert:/etc/identity","--cert-types=clientcert:client","--cert-types=servercert:server","--ca-folder=/etc/pki_service/ca/"],"env":[{"name":"MADKUB_NODENAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"spec.nodeName"}}},{"name":"MADKUB_NAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.name"}}},{"name":"MADKUB_NAMESPACE","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.namespace"}}}],"resources":{},"volumeMounts":[{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"tokens","mountPath":"/etc/identity/tokens"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}],"imagePullPolicy":"IfNotPresent"}},{"op":"add","path":"/spec/containers/-","value":{"name":"madkub-refresher","image":"gcr.io/gsf-mgmt-devmvp-spinnaker/dva/sam/madkub:122","args":["/sam/madkub-client","--mode","gcpserviceaccount","--sa-secret","/secrets/serviceaccount/key.json","--maddog-endpoint","https://10.168.193.16:8443","--maddog-server-ca","/etc/pki_service/ca/cacerts.pem","--cert-folders","clientcert:/etc/identity","--cert-folders","servercert:/etc/identity","--cert-types","clientcert:client","--cert-types","servercert:server","--refresher","--run-init-for-refresher-mode","--ca-folder","/etc/pki_service/ca/"],"env":[{"name":"MADKUB_NODENAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"spec.nodeName"}}},{"name":"MADKUB_NAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.name"}}},{"name":"MADKUB_NAMESPACE","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.namespace"}}}],"resources":{},"volumeMounts":[{"name":"ca","mountPath":"/etc/pki_service/ca"},{"name":"ca","mountPath":"/etc/identity/ca"},{"name":"clientcert","mountPath":"/etc/identity/client"},{"name":"servercert","mountPath":"/etc/identity/server"},{"name":"svcaccount","mountPath":"/secrets/serviceaccount"}]}},{"op":"add","path":"/spec/volumes/-","value":{"name":"ca","emptyDir":{"medium":"Memory"}}},{"op":"add","path":"/spec/volumes/-","value":{"name":"clientcert","emptyDir":{"medium":"Memory"}}},{"op":"add","path":"/spec/volumes/-","value":{"name":"servercert","emptyDir":{"medium":"Memory"}}},{"op":"add","path":"/spec/volumes/-","value":{"name":"tokens","emptyDir":{"medium":"Memory"}}},{"op":"add","path":"/spec/volumes/-","value":{"name":"svcaccount","secret":{"secretName":"svcaccount"}}},{"op":"add","path":"/metadata/annotations/madkub.k8s-integration.sfdc.com~1status","value":"injected"}]